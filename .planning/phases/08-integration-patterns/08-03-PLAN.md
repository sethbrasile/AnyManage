---
phase: 08-integration-patterns
plan: 03
type: execute
wave: 2
depends_on: ["08-02"]
files_modified:
  - .github/skills/trello-sync/SKILL.md
  - ops/TASK_SYNC_PLAYBOOK.md
  - INSTRUCTIONS.md
autonomous: true

must_haves:
  truths:
    - "User can sync tasks bidirectionally with Trello"
    - "User has operational guide for sync workflows"
    - "INSTRUCTIONS.md includes integration session startup check"
    - "Trello integration implements all required hooks from framework"
  artifacts:
    - path: ".github/skills/trello-sync/SKILL.md"
      provides: "Complete Trello integration skill"
      min_lines: 120
      contains: "bidirectional"
    - path: "ops/TASK_SYNC_PLAYBOOK.md"
      provides: "Operational sync workflow guide"
      min_lines: 80
    - path: "INSTRUCTIONS.md"
      provides: "Updated with integration startup check"
      contains: "INTEGRATIONS.md"
  key_links:
    - from: ".github/skills/trello-sync/SKILL.md"
      to: "docs/protocols/integration-framework.md"
      via: "Protocol reference"
      pattern: "integration-framework"
    - from: "ops/TASK_SYNC_PLAYBOOK.md"
      to: ".github/skills/trello-sync/SKILL.md"
      via: "Skill reference"
      pattern: "trello-sync"
---

<objective>
Create Trello integration as reference implementation and operational sync playbook.

Purpose: Trello is the reference implementation showing how integrations work. The sync playbook provides operational guidance for daily use. INSTRUCTIONS.md update ensures integrations are checked on session startup.

Output:
- .github/skills/trello-sync/SKILL.md - complete Trello integration skill
- ops/TASK_SYNC_PLAYBOOK.md - operational guide for sync workflows
- INSTRUCTIONS.md update - integration startup check
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-integration-patterns/08-CONTEXT.md
@.planning/phases/08-integration-patterns/08-RESEARCH.md
@.planning/phases/08-integration-patterns/08-02-SUMMARY.md
@INSTRUCTIONS.md
@docs/protocols/integration-framework.md
@templates/INTEGRATION_TEMPLATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .github/skills/trello-sync/SKILL.md</name>
  <files>.github/skills/trello-sync/SKILL.md</files>
  <action>
Create complete Trello integration skill following the integration template pattern.

Structure:

1. **Frontmatter**
```yaml
---
name: trello-sync
description: Sync tasks bidirectionally with Trello boards
triggers:
  - "sync trello"
  - "sync with trello"
  - "update trello"
  - "trello sync"
  - "pull from trello"
  - "push to trello"
integration:
  service: "trello"
  mcp_server: "@delorenj/mcp-server-trello"
  requires_auth: true
---
```

2. **Overview**
   - What it does: Bidirectional task sync with Trello boards
   - Dual source of truth: Trello = status, local = context
   - Authentication required: Trello API key + token

3. **Required Hooks Implementation**

**Setup Hook**
- Prerequisite: Node.js (for npx)
- MCP server: @delorenj/mcp-server-trello (from Official MCP Registry)
- Credential collection:
  1. Direct user to trello.com/power-ups/admin
  2. Have them create Power-Up to get API key
  3. Generate token URL: `https://trello.com/1/authorize?expiration=never&name=AgentPM&scope=read,write&response_type=token&key={API_KEY}`
  4. User authorizes and provides token
- Installation commands (agent executes, user never sees):
  - Claude Code: `claude mcp add --transport stdio --env TRELLO_API_KEY=... --env TRELLO_TOKEN=... trello -- npx -y @delorenj/mcp-server-trello`
  - opencode: Update opencode.json mcp section
- Verification: Call `trello_list_boards` to confirm connection

**Sync Hook**
- Pull operations:
  - Get boards user has access to
  - For configured board: Get all cards
  - Map card status to local task status (checkbox)
  - Map card due dates to local metadata
  - Map card labels to local tags
- Push operations:
  - Detect local task completions
  - Update card status in Trello
  - Add comments for significant updates
- Bidirectional mapping:
  | Trello | Local | Direction |
  |--------|-------|-----------|
  | Card name | Task title | bidirectional |
  | Card status (list) | Task checkbox | bidirectional |
  | Due date | Metadata | bidirectional |
  | Labels | Tags | external -> local |
  | Card description | Task notes | external -> local |
  | Comments | (not synced) | - |
- Conflict resolution: Trello wins on true conflict (both changed since last sync)
- User notification: "Conflict on [task]. Kept Trello version: [status]"

**Error Hook**
- Connection failure:
  1. Log error (ops/logs/agent-actions.log) - sanitize credentials
  2. Display: "Trello unavailable, using local data"
  3. Silent retry (5s delay)
  4. If still failing: Continue local-only
  5. Monitor for recovery
  6. On recovery: "Trello available. Sync pending changes?"
- Rate limit (429):
  - Trello limits: 300 req/10s per API key, 100 req/10s per token
  - Display: "Trello rate limited. Try again in a few minutes."
  - Suggest batching if many operations
- Auth failure:
  - Display: "Trello authentication failed. Run 'add trello integration' to reconnect."

4. **Optional Hooks Implementation**

**Status Hook**
- Check: Can we reach Trello API?
- Return: Connected/disconnected, last sync time, pending sync count

**Board Configuration**
- First run: "Which Trello board should I sync with?"
- List available boards
- Store selection in INTEGRATIONS.md

5. **Credentials**
| Credential | Source | User Obtains From |
|------------|--------|-------------------|
| TRELLO_API_KEY | Manual | trello.com/power-ups/admin (create Power-Up) |
| TRELLO_TOKEN | Generated | Authorization URL with API key |
| TRELLO_BOARD_ID | Selected | Chosen during setup from available boards |

6. **Rate Limits**
| Limit | Value | Handling |
|-------|-------|----------|
| Per API key | 300/10s | Batch operations, queue excess |
| Per token | 100/10s | Respect limit, delay if needed |

7. **User Communication**
- Sync success: "Synced 5 tasks with Trello (3 updated, 2 new)"
- Sync partial: "Synced 3/5 tasks. 2 failed due to rate limit - try again shortly."
- No changes: "Trello is up to date."
  </action>
  <verify>File exists with 120+ lines, contains bidirectional sync logic, has all three required hooks (setup, sync, error)</verify>
  <done>Trello integration skill is complete and follows integration framework</done>
</task>

<task type="auto">
  <name>Task 2: Create ops/TASK_SYNC_PLAYBOOK.md</name>
  <files>ops/TASK_SYNC_PLAYBOOK.md</files>
  <action>
Create operational playbook for sync workflows - daily use guide for users.

Structure:

1. **Introduction**
   - What this is: Quick reference for sync operations
   - When to use: Daily task management with external tools

2. **Quick Commands**
   | Command | What It Does |
   |---------|-------------|
   | "Sync trello" | Full bidirectional sync |
   | "Pull from trello" | Get updates from Trello only |
   | "Push to trello" | Send local changes to Trello only |
   | "Check integrations" | See connection status |

3. **Daily Workflow**
   **Morning:**
   1. Start session (integration auto-checked)
   2. If connected: "Sync trello" to get overnight updates
   3. Review any conflicts resolved

   **During work:**
   - Mark tasks complete locally - will sync automatically
   - Add notes to tasks - stays local (that's the point!)
   - If "unavailable" message: Work continues, sync later

   **End of day:**
   - Optional: "Sync trello" to push any final updates
   - Or just close - next session will catch up

4. **Common Scenarios**

   **Scenario: Worked offline**
   - You made changes without Trello connection
   - When back online: "Sync trello"
   - Local changes push to Trello

   **Scenario: Team made changes in Trello**
   - You didn't touch tasks, team did
   - "Sync trello" pulls their updates
   - Your local files now reflect current status

   **Scenario: Conflict detected**
   - Both you and Trello changed same task
   - System keeps Trello version (external wins)
   - You're notified: "Conflict on [task]. Kept Trello: [status]"
   - Your local context notes are preserved

   **Scenario: Trello is down**
   - Message: "Trello unavailable, using local data"
   - Keep working normally
   - When Trello recovers: "Sync pending changes?"

5. **What Syncs Where**
   | What | Where It Lives | Why |
   |------|---------------|-----|
   | Task status (done/not done) | Trello | Team visibility |
   | Due dates | Trello | Calendar integration |
   | Task context/notes | Local files | Rich detail, history |
   | Background info | Local files | Not for Trello |
   | Quick comments | Trello | Team communication |
   | Detailed discussion | Local files | Long-form content |

6. **Troubleshooting**
   | Problem | Solution |
   |---------|----------|
   | "Authentication failed" | Run "add trello integration" to reconnect |
   | "Rate limited" | Wait a few minutes, then sync again |
   | Sync seems stuck | "Check integrations" to see status |
   | Wrong board syncing | Run setup again to choose different board |

7. **Best Practices**
   - Sync at session start and end for best consistency
   - Don't worry about conflicts - external wins is predictable
   - Keep detailed notes locally - that's what local files are for
   - Use Trello for status, local for context
  </action>
  <verify>File exists with 80+ lines, has Daily Workflow section, has Troubleshooting section</verify>
  <done>Users have operational guide for daily sync workflows</done>
</task>

<task type="auto">
  <name>Task 3: Update INSTRUCTIONS.md with integration startup check</name>
  <files>INSTRUCTIONS.md</files>
  <action>
Add integration check to session startup protocol in INSTRUCTIONS.md.

Find the session startup section and add integration check step.

Add after existing startup steps (before "Ready for instructions"):

```markdown
### Integration Status (if configured)

Check INTEGRATIONS.md for configured integrations. For each:
1. Quick health check (3-second timeout)
2. Display status: `Integrations: [service] (connected|unavailable)`

If integration unavailable at startup:
- Note in status line: `[service] (unavailable - using local data)`
- Don't block startup
- Monitor for recovery during session

If INTEGRATIONS.md doesn't exist or has no integrations:
- Skip silently (integrations are optional)
```

Also add to the "What I can help with" section (or equivalent):

```markdown
### Integrations (Optional)
- Add integrations: "Add Trello integration"
- Sync tasks: "Sync trello"
- Check status: "Check integrations"

See INTEGRATIONS.md for current status.
```

Preserve all existing INSTRUCTIONS.md content - this is an addition, not a replacement.
  </action>
  <verify>INSTRUCTIONS.md contains "INTEGRATIONS.md" reference, has integration startup check section</verify>
  <done>INSTRUCTIONS.md includes integration awareness on session startup</done>
</task>

</tasks>

<verification>
- [ ] .github/skills/trello-sync/SKILL.md exists with 120+ lines
- [ ] ops/TASK_SYNC_PLAYBOOK.md exists with 80+ lines
- [ ] INSTRUCTIONS.md updated with integration startup check
- [ ] Trello skill implements all three required hooks
- [ ] Playbook covers daily workflow scenarios
- [ ] All files link appropriately
</verification>

<success_criteria>
1. Trello integration is fully documented as reference implementation
2. Users have operational guide for daily sync workflows
3. Integration status is checked on session startup
4. All integration framework hooks are implemented in Trello skill
</success_criteria>

<output>
After completion, create `.planning/phases/08-integration-patterns/08-03-SUMMARY.md`
</output>
