---
phase: 02-agent-instruction-layer
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - .claude/settings.json
  - .claude/commands/.gitkeep
  - .opencode/agents/default.md
  - .agent/AGENT.md
  - .cursorrules
autonomous: true

must_haves:
  truths:
    - "Claude Code can load project via .claude/settings.json"
    - "opencode can load project via .opencode/agents/default.md"
    - "codex/generic agents can use .agent/AGENT.md"
    - "Cursor can load project via .cursorrules"
    - "All wrappers reference INSTRUCTIONS.md as source of truth"
  artifacts:
    - path: ".claude/settings.json"
      provides: "Claude Code project configuration"
      contains: "allowedTools"
    - path: ".opencode/agents/default.md"
      provides: "opencode default agent"
      min_lines: 15
      contains: "INSTRUCTIONS.md"
    - path: ".agent/AGENT.md"
      provides: "codex/generic agent wrapper"
      min_lines: 15
      contains: "INSTRUCTIONS.md"
    - path: ".cursorrules"
      provides: "Cursor compatibility"
      min_lines: 10
      contains: "INSTRUCTIONS.md"
  key_links:
    - from: ".claude/settings.json"
      to: "INSTRUCTIONS.md"
      via: "Project configuration points to instructions"
      pattern: "INSTRUCTIONS"
    - from: ".opencode/agents/default.md"
      to: "INSTRUCTIONS.md"
      via: "Wrapper references canonical file"
      pattern: "INSTRUCTIONS\\.md"
    - from: ".cursorrules"
      to: "INSTRUCTIONS.md"
      via: "Wrapper references canonical file"
      pattern: "INSTRUCTIONS\\.md"
---

<objective>
Create thin agent-specific wrappers for Claude Code, opencode, codex, and Cursor that reference INSTRUCTIONS.md.

Purpose: Each agent platform has its own configuration format. These wrappers enable platform-specific features while keeping INSTRUCTIONS.md as the single source of truth for behavior.

Output:
- `/.claude/settings.json` - Claude Code project settings
- `/.claude/commands/.gitkeep` - Placeholder for future slash commands
- `/.opencode/agents/default.md` - opencode default agent
- `/.agent/AGENT.md` - codex/generic wrapper
- `/.cursorrules` - Cursor compatibility
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-agent-instruction-layer/02-CONTEXT.md
@.planning/phases/02-agent-instruction-layer/02-RESEARCH.md
@INSTRUCTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Claude Code wrapper (.claude/)</name>
  <files>
.claude/settings.json
.claude/commands/.gitkeep
  </files>
  <action>
Create Claude Code project configuration.

**Note:** .claude/ directory already exists (from Phase 1). Add settings.json and commands/ subdirectory.

**1. .claude/settings.json**

```json
{
  "projectName": "Agent PM",
  "description": "AI-powered project management for non-technical PMs. See INSTRUCTIONS.md for agent behavior.",
  "allowedTools": [
    "Read",
    "Write",
    "Edit",
    "Bash",
    "Glob",
    "Grep"
  ],
  "mcpServers": {}
}
```

**Notes:**
- mcpServers empty because INTG-01 requires standalone operation
- MCP integrations will be added in Phase 8
- allowedTools enables core file operations
- No settings.local.json (that's user-specific, not committed)

**2. .claude/commands/.gitkeep**

Create placeholder directory for slash commands (will be populated in Phase 4: Skill System).

Content:
```
# Claude Code Slash Commands

This directory contains custom slash command definitions.

Commands are added in Phase 4 (Skill System Foundation).
Placeholder created in Phase 2 to establish directory structure.

See INSTRUCTIONS.md for command patterns.
```
  </action>
  <verify>
1. `.claude/settings.json` exists and is valid JSON
2. `.claude/commands/.gitkeep` exists
3. `cat .claude/settings.json | grep -c "Agent PM"` returns 1
4. `cat .claude/settings.json | grep -c "INSTRUCTIONS.md"` returns 1
  </verify>
  <done>
Claude Code wrapper complete:
- .claude/settings.json with project config
- .claude/commands/.gitkeep placeholder for Phase 4 skills
  </done>
</task>

<task type="auto">
  <name>Task 2: Create opencode wrapper (.opencode/)</name>
  <files>.opencode/agents/default.md</files>
  <action>
Create opencode agent configuration.

**Directory structure:**
```
.opencode/
  agents/
    default.md
```

**default.md content (~20-30 lines):**

```markdown
# Agent PM - opencode Agent

## Role
AI project management assistant for non-technical users.

## Instructions
Read and follow `/INSTRUCTIONS.md` for complete agent behavior.

## Key Points
- Target user: Non-technical PM (no CLI/git exposure)
- Session startup: Load STATE.md, check PAUSE.md, silent ready
- Commands: Natural language or `/command-name` format
- Git: Automated and invisible to user

## Capabilities
This agent operates with file read/write permissions.
For operations requiring external APIs, offer manual alternatives.

## Reference Files
- `INSTRUCTIONS.md` - Canonical agent behavior
- `STATE.md` - Session state
- `docs/protocols/` - Detailed documentation
```

**Key principle:** Thin wrapper. Don't duplicate INSTRUCTIONS.md content. Reference it.
  </action>
  <verify>
1. `.opencode/agents/default.md` exists
2. File contains "INSTRUCTIONS.md"
3. File is 15-40 lines (thin wrapper, not duplication)
4. `wc -l .opencode/agents/default.md` returns 15-40
  </verify>
  <done>
opencode wrapper complete:
- .opencode/agents/default.md references INSTRUCTIONS.md
- Thin wrapper provides context without duplication
  </done>
</task>

<task type="auto">
  <name>Task 3: Create codex/generic wrapper (.agent/) and Cursor compatibility (.cursorrules)</name>
  <files>
.agent/AGENT.md
.cursorrules
  </files>
  <action>
Create wrappers for codex/generic agents and Cursor.

**1. .agent/AGENT.md (~20-30 lines)**

Generic wrapper for codex and other agents:

```markdown
# Agent PM - Generic Agent Instructions

## Role
AI project management assistant for non-technical users.

## Primary Instructions
All agent behavior is defined in `/INSTRUCTIONS.md` at the project root.
Read that file for complete operational instructions.

## Quick Reference
- **Target user:** Non-technical PM (email/spreadsheet level, not CLI/git)
- **Session startup:** Load STATE.md, check PAUSE.md, await commands
- **Commands:** Natural language ("Process notes for Acme") or slash ("/process-notes Acme")
- **Git:** Automated and invisible - never expose to user

## Documentation
- `INSTRUCTIONS.md` - Complete agent behavior
- `STATE.md` - Current session state
- `docs/protocols/` - Detailed operational documentation
- `docs/guides/` - User-facing guides

## Fallback Behavior
If capabilities are limited, offer manual alternatives.
See `docs/protocols/agent-optimization.md` for capability tiers.
```

**2. .cursorrules (~15-25 lines)**

Cursor compatibility file:

```markdown
# Cursor Instructions for Agent PM

This project uses INSTRUCTIONS.md as the canonical source of truth.
Read /INSTRUCTIONS.md for complete agent behavior.

## Quick Reference
- Target user: Non-technical project manager
- Commands: Natural language or slash command format
- Git operations: Automated and invisible
- Documentation: Plain English, no jargon

## Cursor-Specific
- Project Rules in .cursor/rules/ (if created) extend these instructions
- For detailed protocols, see docs/protocols/

## Reference
See INSTRUCTIONS.md for:
- Session startup protocol
- Command patterns
- File structure
- Error handling
```

**Key principle:** Both are thin wrappers pointing to INSTRUCTIONS.md. No behavior duplication.
  </action>
  <verify>
1. `.agent/AGENT.md` exists
2. `.cursorrules` exists
3. Both files contain "INSTRUCTIONS.md"
4. `.agent/AGENT.md` is 15-40 lines
5. `.cursorrules` is 10-30 lines
  </verify>
  <done>
codex/generic and Cursor wrappers complete:
- .agent/AGENT.md for codex and other generic agents
- .cursorrules for Cursor compatibility
- Both reference INSTRUCTIONS.md as source of truth
  </done>
</task>

</tasks>

<verification>
- [ ] .claude/settings.json exists with valid JSON
- [ ] .claude/commands/.gitkeep exists as placeholder
- [ ] .opencode/agents/default.md exists and references INSTRUCTIONS.md
- [ ] .agent/AGENT.md exists and references INSTRUCTIONS.md
- [ ] .cursorrules exists and references INSTRUCTIONS.md
- [ ] All wrappers are thin (<40 lines each)
- [ ] No behavior duplication (all point to INSTRUCTIONS.md)
</verification>

<success_criteria>
1. Claude Code can configure project via .claude/settings.json
2. opencode can load agent definition from .opencode/agents/default.md
3. codex/generic agents can use .agent/AGENT.md
4. Cursor can use .cursorrules for compatibility
5. All wrappers point to INSTRUCTIONS.md (single source of truth)
6. Requirement CORE-08 (thin agent-specific wrappers) is satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-agent-instruction-layer/02-03-SUMMARY.md`
</output>
