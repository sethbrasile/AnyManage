---
phase: 03-entity-management
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - docs/protocols/profile-building.md
  - docs/protocols/note-processing.md
  - INSTRUCTIONS.md
autonomous: true

must_haves:
  truths:
    - "User can say 'Add CEO is John Smith to Acme profile' and profile is updated"
    - "User can say 'Process notes for Acme' and tasks are extracted to roadmap"
    - "Profile updates go to contextually appropriate sections"
    - "Processed notes are marked and archived"
    - "User sees itemized report of what was extracted"
  artifacts:
    - path: "docs/protocols/profile-building.md"
      provides: "Complete profile update protocol"
      contains: "## Smart Placement"
    - path: "docs/protocols/note-processing.md"
      provides: "Complete note processing protocol"
      contains: "## Extraction Categories"
    - path: "INSTRUCTIONS.md"
      provides: "Core Workflows with profile and note processing references"
      contains: "docs/protocols/profile-building"
  key_links:
    - from: "INSTRUCTIONS.md"
      to: "docs/protocols/profile-building.md"
      via: "reference in Core Workflows"
      pattern: "profile-building"
    - from: "INSTRUCTIONS.md"
      to: "docs/protocols/note-processing.md"
      via: "reference in Core Workflows"
      pattern: "note-processing"
---

<objective>
Create profile building and note processing protocol documentation that enables users to incrementally update entity information and extract structured data from unstructured notes.

Purpose: These are the core "data in" workflows - how information gets into the system. Profile building handles explicit additions ("Add X to profile"), note processing handles bulk extraction from meeting notes or voice memos.

Output: Two protocol documents in docs/protocols/ and updated INSTRUCTIONS.md with workflow references.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-entity-management/03-CONTEXT.md

# Reference prior plan output
@.planning/phases/03-entity-management/03-01-SUMMARY.md

# Existing files
@INSTRUCTIONS.md
@docs/protocols/entity-onboarding.md
@templates/ENTITY_PROFILE_TEMPLATE.md
@templates/ENTITY_ROADMAP_TEMPLATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile building protocol documentation</name>
  <files>docs/protocols/profile-building.md</files>
  <action>
Create comprehensive protocol documentation for incremental profile updates. The document must cover:

**Trigger Detection:**
- Natural language: "Add [fact] to [entity]'s profile", "Update Acme's CEO to John Smith"
- "Add" implies new info, "Update" implies replacement
- Entity name extraction from various phrasings

**Smart Section Placement:**
Map fact types to ENTITY_PROFILE.md sections:
- Contact info -> Key Contacts table
- Company details (size, revenue, founded) -> Entity Information table
- Goals/priorities -> Business Goals section
- Relationship info -> Our Relationship section
- Communication preferences -> Communication Preferences section
- Background/context -> Notes > Background Context
- Working style -> Notes > Working Style Preferences

If section doesn't exist, create it. If unclear where fact belongs, use "Notes > Things to Remember".

**Update Mechanics:**
- Parse existing profile to find target section
- For tables: Add row or update existing row (match by name/identifier)
- For bullet lists: Append new bullet
- For prose sections: Append new paragraph
- Conflicting info: Replace old with new (user said "update", so new is authoritative)

**Confirmation:**
- After update: "Added to [section name]: [brief summary]"
- Multiple facts: Process all, report each placement
- No confirmation before making changes (silent updates per CONTEXT.md)

**Error Handling:**
- Entity not found: "No entity named 'Acme' found. Create it first with 'Add new client Acme'?"
- Profile file corrupted: Log error, offer to recreate from template
- Ambiguous fact: Ask for clarification ("Is John Smith a contact or the founder?")

Format: Follow existing protocol doc style. Include examples showing different fact types and their placement.
  </action>
  <verify>
File exists at docs/protocols/profile-building.md with:
- Trigger patterns section
- Section mapping table (fact type -> profile section)
- Update mechanics for tables, lists, prose
- Confirmation message templates
- At least 4 example interactions showing different fact types
  </verify>
  <done>
Protocol covers: smart placement, silent updates, replace old info, mixed format (per CONTEXT.md).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create note processing protocol documentation</name>
  <files>docs/protocols/note-processing.md</files>
  <action>
Create comprehensive protocol documentation for processing unstructured notes into structured data. The document must cover:

**Trigger Detection:**
- Natural language: "Process notes for Acme", "Extract tasks from these notes"
- Slash command: `/process-notes [entity]`
- Batch: "Process notes for Acme, Beta, and Gamma"

**Input Sources (per CONTEXT.md):**
1. **Pasted inline:** User pastes note content directly in chat
2. **File in entity notes folder:** Process entities/[Name]/notes/[filename].md
3. **Top-level NOTES.md:** Route to correct entity or internal ops based on content

**Extraction Categories:**
- **Tasks:** Action items with deadlines if mentioned -> entity ROADMAP.md
- **Profile facts:** Information about the entity -> entity PROFILE.md (use profile-building protocol)
- **Calendar items:** Dates, meetings, deadlines -> noted in roadmap or ops calendar
- **Follow-ups:** Items needing user decision or clarification -> listed for user review

**Extraction Process:**
1. Read note content
2. Identify entity (from command or note content)
3. Extract items by category
4. Check for duplicates before adding (especially tasks)
5. Apply changes to appropriate files
6. Mark note as processed
7. Archive note to notes/archive/
8. Report results to user

**Processed Note Handling:**
- Add header to note: `<!-- Processed by Claude on YYYY-MM-DD -->`
- Move file to entities/[Name]/notes/archive/
- Never delete original notes

**Itemized Reporting:**
After processing, show user:
```
Processed notes for Acme Corp:
- Tasks added to roadmap (3):
  - [ ] Follow up on budget proposal
  - [ ] Schedule Q2 review meeting
  - [ ] Send revised timeline
- Profile updated:
  - Added new contact: Sarah Chen (CFO)
- Follow-ups for you:
  - Confirm April 15 deadline works?
```

**Discussion Mode:**
If note content is ambiguous or "prompt-like" (contains instructions for the agent rather than data):
- Pause extraction
- Ask user: "This looks like instructions rather than notes. Should I [action] or process as notes?"

**Duplicate Task Detection:**
Before adding task, check roadmap for similar tasks:
- Exact match: Skip, note in report
- Similar match: Ask user "Similar task exists: '[existing]'. Add anyway?"

Format: Follow existing protocol doc style. Include comprehensive examples.
  </action>
  <verify>
File exists at docs/protocols/note-processing.md with:
- Three input sources documented
- Extraction categories with destination mapping
- Duplicate detection logic
- Processed note handling (header + archive)
- Itemized report format
- Discussion mode for ambiguous content
- At least 2 complete example interactions
  </verify>
  <done>
Protocol covers all CONTEXT.md decisions: three input sources, full triage extraction, processed notes marked and archived, itemized reporting, discussion mode for ambiguous items.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update INSTRUCTIONS.md with both workflow references</name>
  <files>INSTRUCTIONS.md</files>
  <action>
Update INSTRUCTIONS.md to reference both new protocols.

**In "Core Workflows" section, add/update entries:**

Add after Entity Onboarding:
```
- **Profile Building:** Add facts with "Add [fact] to [entity]'s profile". Facts are placed in contextually appropriate sections. See `docs/protocols/profile-building.md` for placement rules.
```

Update existing Note Processing entry (if exists) or add:
```
- **Note Processing:** Process meeting notes or voice memos with "Process notes for [entity]". Extracts tasks, profile facts, calendar items, and follow-ups. Processed notes are archived. See `docs/protocols/note-processing.md` for full protocol.
```

**In "Command Patterns" table, ensure these rows exist:**
```
| "Add CEO is John to Acme" | (natural only) | Update entity profile |
| "Process notes for Acme" | `/process-notes Acme` | Extract tasks from notes |
```

Keep existing rows. Add new rows in logical order.

**Do NOT modify other sections.** Keep changes minimal and focused.
  </action>
  <verify>
INSTRUCTIONS.md contains:
- Profile Building entry in Core Workflows with protocol reference
- Note Processing entry in Core Workflows with protocol reference
- Command Patterns rows for profile update and note processing
  </verify>
  <done>
INSTRUCTIONS.md provides clear entry points for both workflows with pointers to detailed protocols.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Verify docs/protocols/profile-building.md exists and is >80 lines
2. Verify docs/protocols/note-processing.md exists and is >100 lines
3. Verify INSTRUCTIONS.md references both new protocols
4. Check consistency between protocols (profile-building referenced from note-processing)
5. Verify no duplicate or conflicting command patterns
</verification>

<success_criteria>
- Profile building protocol fully documented with section mapping
- Note processing protocol fully documented with extraction categories
- INSTRUCTIONS.md updated with both workflow references
- Protocols cross-reference each other appropriately
- Documentation matches all decisions from 03-CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/03-entity-management/03-02-SUMMARY.md`
</output>
